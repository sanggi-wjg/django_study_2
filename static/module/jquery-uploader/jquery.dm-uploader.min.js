!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(o){"use strict";function n(e,t){this.data=e,this.widget=t,this.jqXHR=null,this.status=s,this.id=Math.random().toString(36).substr(2)}var i="dmUploader",s=0,r=1,t=2,u=3,a=4,l={auto:!0,queue:!0,dnd:!0,hookDocument:!0,multiple:!0,url:document.URL,method:"POST",extraData:{},headers:{},dataType:null,fieldName:"file",maxFileSize:0,allowedTypes:"*",extFilter:null,onInit:function(){},onComplete:function(){},onFallbackMode:function(){},onNewFile:function(){},onBeforeUpload:function(){},onUploadProgress:function(){},onUploadSuccess:function(){},onUploadCanceled:function(){},onUploadError:function(){},onUploadComplete:function(){},onFileTypeError:function(){},onFileSizeError:function(){},onFileExtError:function(){},onDragEnter:function(){},onDragLeave:function(){},onDocumentDragEnter:function(){},onDocumentDragLeave:function(){}};n.prototype.upload=function(){var i=this;if(!i.canUpload())return i.widget.queueRunning&&i.status!==r&&i.widget.processQueue(),!1;var n=new FormData;n.append(i.widget.settings.fieldName,i.data);var e=i.widget.settings.extraData;return"function"==typeof e&&(e=e.call(i.widget.element,i.id)),o.each(e,function(e,t){n.append(e,t)}),i.status=r,i.widget.activeFiles++,i.widget.settings.onBeforeUpload.call(i.widget.element,i.id),i.jqXHR=o.ajax({url:i.widget.settings.url,type:i.widget.settings.method,dataType:i.widget.settings.dataType,data:n,headers:i.widget.settings.headers,cache:!1,contentType:!1,processData:!1,forceSync:!1,xhr:function(){return i.getXhr()},success:function(e){i.onSuccess(e)},error:function(e,t,n){i.onError(e,t,n)},complete:function(){i.onComplete()}}),!0},n.prototype.onSuccess=function(e){this.status=t,this.widget.settings.onUploadSuccess.call(this.widget.element,this.id,e)},n.prototype.onError=function(e,t,n){this.status!==a&&(this.status=u,this.widget.settings.onUploadError.call(this.widget.element,this.id,e,t,n))},n.prototype.onComplete=function(){this.widget.activeFiles--,this.status!==a&&this.widget.settings.onUploadComplete.call(this.widget.element,this.id),this.widget.queueRunning?this.widget.processQueue():this.widget.settings.queue&&0===this.widget.activeFiles&&this.widget.settings.onComplete.call(this.element)},n.prototype.getXhr=function(){var s=this,e=o.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var t=0,n=e.loaded||e.position,i=e.total||e.totalSize;e.lengthComputable&&(t=Math.ceil(n/i*100)),s.widget.settings.onUploadProgress.call(s.widget.element,s.id,t)},!1),e},n.prototype.cancel=function(e){e=void 0!==e&&e;var t=this.status;return!!(t===r||e&&t===s)&&(this.status=a,this.widget.settings.onUploadCanceled.call(this.widget.element,this.id),t===r&&this.jqXHR.abort(),!0)},n.prototype.canUpload=function(){return this.status===s||this.status===u};function d(e,t){return this.element=o(e),this.settings=o.extend({},l,t),this.checkSupport()?(this.init(),this):(o.error("Browser not supported by jQuery.dmUploader"),this.settings.onFallbackMode.call(this.element),!1)}d.prototype.checkSupport=function(){return void 0!==window.FormData&&(!new RegExp("/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1.0|2.0|2.5|3.0))/").test(window.navigator.userAgent)&&!o('<input type="file" />').prop("disabled"))},d.prototype.init=function(){var t=this;this.queue=[],this.queuePos=-1,this.queueRunning=!1,this.activeFiles=0,this.draggingOver=0,this.draggingOverDoc=0;var e=t.element.is("input[type=file]")?t.element:t.element.find("input[type=file]");return 0<e.length&&(e.prop("multiple",this.settings.multiple),e.on("change."+i,function(e){e=e.target&&e.target.files;e&&e.length&&(t.addFiles(e),o(this).val(""))})),this.settings.dnd&&this.initDnD(),0!==e.length||this.settings.dnd?(this.settings.onInit.call(this.element),this):(o.error("Markup error found by jQuery.dmUploader"),null)},d.prototype.initDnD=function(){var n=this;n.element.on("drop."+i,function(e){e.preventDefault(),0<n.draggingOver&&(n.draggingOver=0,n.settings.onDragLeave.call(n.element));var t=e.originalEvent&&e.originalEvent.dataTransfer;t&&t.files&&t.files.length&&(e=[],n.settings.multiple?e=t.files:e.push(t.files[0]),n.addFiles(e))}),n.element.on("dragenter."+i,function(e){e.preventDefault(),0===n.draggingOver&&n.settings.onDragEnter.call(n.element),n.draggingOver++}),n.element.on("dragleave."+i,function(e){e.preventDefault(),n.draggingOver--,0===n.draggingOver&&n.settings.onDragLeave.call(n.element)}),n.settings.hookDocument&&(o(document).off("drop."+i).on("drop."+i,function(e){e.preventDefault(),0<n.draggingOverDoc&&(n.draggingOverDoc=0,n.settings.onDocumentDragLeave.call(n.element))}),o(document).off("dragenter."+i).on("dragenter."+i,function(e){e.preventDefault(),0===n.draggingOverDoc&&n.settings.onDocumentDragEnter.call(n.element),n.draggingOverDoc++}),o(document).off("dragleave."+i).on("dragleave."+i,function(e){e.preventDefault(),n.draggingOverDoc--,0===n.draggingOverDoc&&n.settings.onDocumentDragLeave.call(n.element)}),o(document).off("dragover."+i).on("dragover."+i,function(e){e.preventDefault()}))},d.prototype.releaseEvents=function(){this.element.off("."+i),this.element.find("input[type=file]").off("."+i),this.settings.hookDocument&&o(document).off("."+i)},d.prototype.validateFile=function(e){if(0<this.settings.maxFileSize&&e.size>this.settings.maxFileSize)return this.settings.onFileSizeError.call(this.element,e),!1;if("*"!==this.settings.allowedTypes&&!e.type.match(this.settings.allowedTypes))return this.settings.onFileTypeError.call(this.element,e),!1;if(null!==this.settings.extFilter){var t=e.name.toLowerCase().split(".").pop();if(o.inArray(t,this.settings.extFilter)<0)return this.settings.onFileExtError.call(this.element,e),!1}return new n(e,this)},d.prototype.addFiles=function(e){for(var t=0,n=0;n<e.length;n++){var i=this.validateFile(e[n]);i&&!1!==this.settings.onNewFile.call(this.element,i.id,i.data)&&(this.settings.auto&&!this.settings.queue&&i.upload(),this.queue.push(i),t++)}return 0===t||this.settings.auto&&this.settings.queue&&!this.queueRunning&&this.processQueue(),this},d.prototype.processQueue=function(){return this.queuePos++,this.queuePos>=this.queue.length?(0===this.activeFiles&&this.settings.onComplete.call(this.element),this.queuePos=this.queue.length-1,this.queueRunning=!1):(this.queueRunning=!0,this.queue[this.queuePos].upload())},d.prototype.restartQueue=function(){this.queuePos=-1,this.queueRunning=!1,this.processQueue()},d.prototype.findById=function(e){for(var t=!1,n=0;n<this.queue.length;n++)if(this.queue[n].id===e){t=this.queue[n];break}return t},d.prototype.cancelAll=function(){var e=this.queueRunning;this.queueRunning=!1;for(var t=0;t<this.queue.length;t++)this.queue[t].cancel();e&&this.settings.onComplete.call(this.element)},d.prototype.startAll=function(){if(this.settings.queue)this.restartQueue();else for(var e=0;e<this.queue.length;e++)this.queue[e].upload()},d.prototype.methods={start:function(e){if(this.queueRunning)return!1;var t=!1;return void 0===e||(t=this.findById(e))?t?(t.status===a&&(t.status=s),t.upload()):(this.startAll(),!0):(o.error("File not found in jQuery.dmUploader"),!1)},cancel:function(e){var t=!1;return void 0===e||(t=this.findById(e))?t?t.cancel(!0):(this.cancelAll(),!0):(o.error("File not found in jQuery.dmUploader"),!1)},reset:function(){return this.cancelAll(),this.queue=[],this.queuePos=-1,!(this.activeFiles=0)},destroy:function(){this.cancelAll(),this.releaseEvents(),this.element.removeData(i)}},o.fn.dmUploader=function(t){var n=arguments;if("string"!=typeof t)return this.each(function(){o.data(this,i)||o.data(this,i,new d(this,t))});this.each(function(){var e=o.data(this,i);e instanceof d?"function"==typeof e.methods[t]?e.methods[t].apply(e,Array.prototype.slice.call(n,1)):o.error("Method "+t+" does not exist in jQuery.dmUploader"):o.error("Unknown plugin data found by jQuery.dmUploader")})}});